stages:
  - test 

image: docker:latest

services:
  - docker:dind


before_script:
  - docker info
  - apk update
  - apk upgrade
  - apk add curl 
  - apk add --no-cache --upgrade bash
  - apk add python3 py3-pip build-base
  - pip install docker-compose
  - sh -c bash
  - apk add --update nodejs npm
  - npm install --global yarn
  - apk add --update openjdk11
  - apk add openssl
  - yarn install
  - yarn run setup
  - yarn run dt:mapping:pipeline 
  - cd scripts/cert
  - chmod +x main.sh
  - bash main.sh
  - cd ../../
  - docker-compose --profile backend up --wait

test-admin-access:
  stage: test  
    
  script:
    - docker-compose --profile test up --wait
    - echo "Testing admin access..."
    - cd specification-tests
    - chmod +x ./run.sh
    - bash run.sh -d . admin-any

after_script:
    - docker stop -t 0 architecture-css-test-1
    - docker rm architecture-css-test-1

 